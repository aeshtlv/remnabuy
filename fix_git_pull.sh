#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ git pull –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./fix_git_pull.sh

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ git pull..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
if git diff --quiet src/config.py; then
    echo "‚úì –ù–µ—Ç –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ src/config.py"
    echo "–í—ã–ø–æ–ª–Ω—è—é git pull..."
    git pull
    exit 0
fi

echo "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ src/config.py"
echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
echo "1) –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ pull (stash) - –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø"
echo "2) –û—Ç–∫–∞—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
echo "3) –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
echo ""
read -p "–í–∞—à –≤—ã–±–æ—Ä (1-3): " choice

case $choice in
    1)
        echo "üíæ –°–æ—Ö—Ä–∞–Ω—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ stash..."
        git stash save "–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è config.py –ø–µ—Ä–µ–¥ pull"
        
        echo "‚¨áÔ∏è –í—ã–ø–æ–ª–Ω—è—é git pull..."
        git pull
        
        echo "üì¶ –ü—Ä–∏–º–µ–Ω—è—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
        git stash pop
        
        if [ $? -ne 0 ]; then
            echo "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ stash"
            echo "–†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤—Ä—É—á–Ω—É—é –≤ src/config.py"
            echo "–ü–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: git add src/config.py && git stash drop"
        else
            echo "‚úì –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã"
        fi
        ;;
    2)
        echo "‚Ü©Ô∏è –û—Ç–∫–∞—Ç—ã–≤–∞—é –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
        git restore src/config.py
        
        echo "‚¨áÔ∏è –í—ã–ø–æ–ª–Ω—è—é git pull..."
        git pull
        echo "‚úì –ì–æ—Ç–æ–≤–æ"
        ;;
    3)
        echo "üìù –î–æ–±–∞–≤–ª—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ staging..."
        git add src/config.py
        
        echo "üí¨ –°–æ–∑–¥–∞—é –∫–æ–º–º–∏—Ç..."
        git commit -m "Update config.py: —É–ª—É—á—à–µ–Ω–æ —á—Ç–µ–Ω–∏–µ .env –∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ"
        
        echo "‚¨áÔ∏è –í—ã–ø–æ–ª–Ω—è—é git pull..."
        git pull
        
        if [ $? -ne 0 ]; then
            echo "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ merge"
            echo "–†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤—Ä—É—á–Ω—É—é –≤ src/config.py"
            echo "–ü–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: git add src/config.py && git commit"
        else
            echo "‚úì –ì–æ—Ç–æ–≤–æ"
        fi
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: git status"

