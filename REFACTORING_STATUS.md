# –°—Ç–∞—Ç—É—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ basic.py

## üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª**: `src/handlers/basic.py` (6945 —Å—Ç—Ä–æ–∫)
- **–¶–µ–ª—å**: –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ –ø–æ –¥–æ–º–µ–Ω–∞–º –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
- **–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 2025-01-XX
- **–°—Ç–∞—Ç—É—Å**: –í –ø—Ä–æ—Ü–µ—Å—Å–µ

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏

#### `src/handlers/state.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: 
  - –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`PENDING_INPUT`, `LAST_BOT_MESSAGES`, `USER_SEARCH_CONTEXT`, `USER_DETAIL_BACK_TARGET`, `SUBS_PAGE_BY_USER`)
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`ADMIN_COMMAND_DELETE_DELAY`, `SEARCH_PAGE_SIZE`, `MAX_SEARCH_RESULTS`, `SUBS_PAGE_SIZE`)
- **–†–∞–∑–º–µ—Ä**: ~29 —Å—Ç—Ä–æ–∫

#### `src/handlers/common.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - `_cleanup_message()` - —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
  - `_send_clean_message()` - –æ—Ç–ø—Ä–∞–≤–∫–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  - `_not_admin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - `_get_target_user_id()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ user_id
  - `_clear_user_state()` - –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `_edit_text_safe()` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–†–∞–∑–º–µ—Ä**: ~127 —Å—Ç—Ä–æ–∫

#### `src/handlers/commands.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: –í—Å–µ Command handlers (35 –∫–æ–º–∞–Ω–¥)
  - `/start`, `/help`, `/health`, `/stats`, `/bandwidth`
  - `/billing`, `/providers`, `/billing_nodes`
  - `/bulk*` (7 –∫–æ–º–∞–Ω–¥)
  - `/user`, `/user_create`
  - `/nodes`, `/nodes_usage`, `/nodes_range`, `/node`
  - `/hosts`, `/host`
  - `/sub`
  - `/tokens`, `/token`
  - `/templates`, `/template`
  - `/snippets`, `/snippet`, `/snippet_add`, `/snippet_update`
  - `/configs`, `/config`
  - `handle_pending()` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **–†–∞–∑–º–µ—Ä**: ~503 —Å—Ç—Ä–æ–∫–∏
- **TODO**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `basic.py` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏

#### `src/handlers/navigation.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - `_navigate()` - —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–µ–Ω—é
  - `_send_subscriptions_page()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–ø–∏—Å–æ–∫
  - `_get_subs_page()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–ø–∏—Å–æ–∫
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `nav:home`, `nav:back`, `menu:back`, `subs:page`, `subs:view`
- **–†–∞–∑–º–µ—Ä**: ~268 —Å—Ç—Ä–æ–∫
- **TODO**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `basic.py` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏

#### `src/handlers/system.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - `_fetch_health_text()` - —Ç–µ–∫—Å—Ç health check
  - `_fetch_panel_stats_text()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–Ω–µ–ª–∏
  - `_fetch_server_stats_text()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
  - `_fetch_stats_text()` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - `_fetch_bandwidth_text()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
  - `_system_nodes_profiles_keyboard()` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:health`, `menu:stats`, `stats:*`, `menu:system_nodes`, `system:nodes:*`
- **–†–∞–∑–º–µ—Ä**: ~500+ —Å—Ç—Ä–æ–∫
- **TODO**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `_fetch_nodes_text()` –∏–∑ `basic.py` –≤ `nodes.py`

#### `src/handlers/users.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–∏—Å–∫, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
  - `_send_user_summary()`, `_send_user_detail()`
  - `_fetch_user()`, `_search_users()`
  - `_user_matches_query()`, `_format_user_choice()`, `_truncate()`, `_iso_from_days()`
  - `_store_user_detail_back_target()`, `_get_user_detail_back_target()`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:create_user`, `user_create:*`, `menu:find_user`, `user_search:view:*`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `user:*`, `user_edit:*`, `uef:*`, `user_configs:*`, `user_sub_link:*`, `user_happ_link:*`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `user_stats:*`, `user_stats:traffic_period:*`, `user_stats:nodes_period:*`
- **–†–∞–∑–º–µ—Ä**: ~900+ —Å—Ç—Ä–æ–∫
- **TODO**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `basic.py`:
  - `_handle_user_create_input()`, `_handle_user_edit_input()`, `_handle_user_search_input()`
  - `_create_user()`, `_apply_user_update()`
  - `_start_user_search_flow()`, `_show_user_search_results()`, `_run_user_search()`
  - `_send_user_create_prompt()`, `_send_squad_prompt()`, `_show_squad_selection_for_edit()`
  - `_build_user_create_preview()`, `_handle_user_create_callback()`
  - `_format_user_edit_snapshot()`, `_current_user_edit_values()`
  - `_delete_ctx_message()`

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### –°–ª–µ–¥—É—é—â–∏–µ –º–æ–¥—É–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:

#### `src/handlers/nodes.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–æ–¥ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
  - `_send_node_detail()`
  - –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã: `_node_config_profiles_keyboard()`, `_node_inbounds_keyboard()`, `_bulk_nodes_select_keyboard()`, `_bulk_profile_select_keyboard()`, `_bulk_profile_inbounds_keyboard()`, `_node_providers_keyboard()`, `_node_yes_no_keyboard()`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:nodes`, `nodes:*`, `node_create:*`, `node_edit:*`, `nef:*`, `node_delete:*`, `node_delete_confirm:*`, `node:*`
- **–†–∞–∑–º–µ—Ä**: ~700+ —Å—Ç—Ä–æ–∫
- **TODO**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `basic.py`:
  - `_handle_node_create_input()`, `_handle_node_edit_input()`
  - `_apply_node_update()`
  - `_fetch_nodes_text()`, `_fetch_nodes_with_keyboard()`
  - `_fetch_nodes_realtime_text()`, `_fetch_nodes_range_text()`

#### `src/handlers/hosts.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ö–æ—Å—Ç–æ–≤ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–ø–∏—Å–æ–∫)
  - `_send_host_detail()`, `_apply_host_update()`
  - –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã: `_host_config_profiles_keyboard()`, `_host_inbounds_keyboard()`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:hosts`, `hosts:create`, `hosts:select_profile:*`, `hosts:select_inbound:*`, `hosts:*`, `host_edit:*`, `hef:*`, `host:*`
- **–†–∞–∑–º–µ—Ä**: ~400+ —Å—Ç—Ä–æ–∫
- **TODO**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `basic.py`:
  - `_handle_host_create_input()`
  - `_fetch_hosts_text()`, `_fetch_hosts_with_keyboard()`

#### `src/handlers/resources.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (—Ç–æ–∫–µ–Ω—ã, —à–∞–±–ª–æ–Ω—ã, —Å–Ω–∏–ø–ø–µ—Ç—ã, –∫–æ–Ω—Ñ–∏–≥–∏)
  - `_show_tokens()`, `_create_token()`
  - `_send_templates()`, `_send_template_detail()`
  - `_send_snippet_detail()`, `_upsert_snippet()`
  - `_send_config_detail()`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:tokens`, `token:*`, `menu:templates`, `template:*`, `tplview:*`, `menu:snippets`, `snippet:*`, `menu:configs`, `config:*`
- **–†–∞–∑–º–µ—Ä**: ~600+ —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `basic.py`
  - `_fetch_tokens_text()`, `_fetch_templates_text()`, `_fetch_snippets_text()`, `_fetch_configs_text()`
  - `_handle_template_create_input()`, `_handle_template_update_json_input()`, `_handle_template_reorder_input()`

#### `src/handlers/billing.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–∏–ª–ª–∏–Ω–≥–∞ –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
  - –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã: `_billing_providers_keyboard()`, `_providers_select_keyboard()`, `_billing_nodes_keyboard()`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:providers`, `providers:*`, `menu:billing`, `billing:*`, `menu:billing_nodes`, `billing_nodes:*`
- **–†–∞–∑–º–µ—Ä**: ~800+ —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `basic.py`
  - `_fetch_billing_text()`, `_fetch_billing_nodes_text()`, `_fetch_billing_stats_text()`, `_fetch_billing_nodes_stats_text()`
  - `_fetch_providers_text()`
  - `_handle_provider_input()`, `_handle_billing_history_input()`, `_handle_billing_nodes_input()`

#### `src/handlers/bulk.py` ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω, —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `basic.py`
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ö–æ—Å—Ç–∞–º–∏
  - `_run_bulk_action()`, `_parse_uuids()`, `_reply()`, `_handle_bulk_users_input()`
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `ALLOWED_STATUSES`
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `menu:bulk_users`, `menu:bulk_hosts`, `bulk:users:*`, `bulk:hosts:*`
- **–†–∞–∑–º–µ—Ä**: ~250+ —Å—Ç—Ä–æ–∫
- **–ò–º–ø–æ—Ä—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `_fetch_hosts_text` –∏–∑ `hosts.py`

## üìã –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ (`state.py`, `common.py`)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `commands.py` —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å `navigation.py` —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å `system.py` —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏
5. ‚è≥ –°–æ–∑–¥–∞—Ç—å `users.py` - —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –º–æ–¥—É–ª—å (~1800 —Å—Ç—Ä–æ–∫)
6. ‚è≥ –°–æ–∑–¥–∞—Ç—å `nodes.py` - –≤—Ç–æ—Ä–æ–π –ø–æ —Ä–∞–∑–º–µ—Ä—É (~1500 —Å—Ç—Ä–æ–∫)
7. ‚è≥ –°–æ–∑–¥–∞—Ç—å `hosts.py` (~700 —Å—Ç—Ä–æ–∫)
8. ‚è≥ –°–æ–∑–¥–∞—Ç—å `resources.py` (~1000 —Å—Ç—Ä–æ–∫)
9. ‚è≥ –°–æ–∑–¥–∞—Ç—å `billing.py` (~800 —Å—Ç—Ä–æ–∫)
10. ‚è≥ –°–æ–∑–¥–∞—Ç—å `bulk.py` (~600 —Å—Ç—Ä–æ–∫)
11. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å `__init__.py` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
12. ‚è≥ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `basic.py` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
13. ‚è≥ –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `basic.py`
14. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
15. ‚è≥ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã

–°–µ–π—á–∞—Å –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö (`commands.py`, `navigation.py`, `system.py`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `basic.py`:

```python
# –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ basic.py - –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
from src.handlers.basic import (
    _fetch_nodes_text,
    _fetch_main_menu_text,
    # ... –∏ —Ç.–¥.
)
```

–≠—Ç–∏ –∏–º–ø–æ—Ä—Ç—ã –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π.

### –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã

–ù—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –†–∞–∑–¥–µ–ª—è—Ç—å –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `common.py`
- –ò–∑–±–µ–≥–∞—Ç—å –≤–∑–∞–∏–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å

- **–°–æ–∑–¥–∞–Ω–æ –º–æ–¥—É–ª–µ–π**: 11 –∏–∑ 11 (100%) ‚úÖ
- **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ —Å—Ç—Ä–æ–∫**: ~6800 –∏–∑ 6945 (98%)
- **–û—Å—Ç–∞–ª–æ—Å—å —Ä–∞–±–æ—Ç—ã**: ~145 —Å—Ç—Ä–æ–∫ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)

## ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

–í—Å–µ –º–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã, `__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤.

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ `resources.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `billing.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ `resources.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `billing.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `hosts.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `bulk.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `navigation.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã, –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ `commands.py` - –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ `nodes.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `users.py` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- ‚úÖ `system.py` - –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `_apply_host_update` –≤ `basic.py`
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `basic.py` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ `_cleanup_message`, `_not_admin`, `_send_clean_message`, `_show_tokens` –∏–∑ `basic.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `common.py`, `resources.py` –∏ `state.py`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–≤

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏–∑ `basic.py` (–æ–Ω–∏ —É–∂–µ –≤ `commands.py`)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ `_cleanup_message`, `_not_admin`, `_send_clean_message`, `_show_tokens`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `common.py`, `resources.py` –∏ `state.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ `basic.py` –æ —Ç–æ–º, –∫–∞–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
- üìä `basic.py`: ~558 —Å—Ç—Ä–æ–∫ (–±—ã–ª–æ ~6950) - —É–º–µ–Ω—å—à–µ–Ω–æ –Ω–∞ ~6392 —Å—Ç—Ä–æ–∫ (~92%)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `_send_subscription_detail` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `navigation.py`
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã (`subscription_keyboard`, `build_subscription_summary`)
- ‚úÖ –í `basic.py` –æ—Å—Ç–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `cb_input_skip` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- üìã –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `commands.py`
- üìã –í—Å–µ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
- üìã –£–¥–∞–ª–µ–Ω—ã –±–æ–ª—å—à–∏–µ –±–ª–æ–∫–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–æ–¥ (nodes:*, node_create:*) - ~374 —Å—Ç—Ä–æ–∫–∏
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ö–æ—Å—Ç–æ–≤ (hosts:*, host_edit:*, hef:*) - ~256 —Å—Ç—Ä–æ–∫
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–µ–Ω—é (menu:tokens, menu:templates, menu:snippets, menu:configs, menu:providers, menu:billing, menu:billing_nodes, menu:bulk_hosts, menu:system_nodes, menu:bulk_users) - ~67 —Å—Ç—Ä–æ–∫
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–∏–ª–ª–∏–Ω–≥–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (providers:*, billing:*, billing_nodes:*, nav:*, subs:*, menu:back) - ~325 —Å—Ç—Ä–æ–∫
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (user:*, user_edit:*, uef:*, user_configs:*, user_sub_link:*, user_happ_link:*, user_stats:*, menu:back) - ~974 —Å—Ç—Ä–æ–∫–∏
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–æ–¥ (node_edit:*, nef:*, node_delete:*, node_delete_confirm:*, node:*) - ~237 —Å—Ç—Ä–æ–∫
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Ö–æ—Å—Ç–æ–≤ (token:*, template:*, snippet:*, tplview:*, host:*, bulk:users:*, bulk:hosts:*) - ~196 —Å—Ç—Ä–æ–∫
  - ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ system:nodes:*, config:* –∏ —Ñ—É–Ω–∫—Ü–∏–∏ bulk helpers - ~192 —Å—Ç—Ä–æ–∫–∏
  - ‚úÖ –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ _send_user_*, _send_node_detail, _send_host_detail, _get_subs_page - ~150 —Å—Ç—Ä–æ–∫
  - ‚úÖ –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ _send_template_detail, _navigate, _send_subscriptions_page, _start_user_search_flow, _handle_user_search_input, _run_user_search, _show_user_search_results, _search_users, _fetch_user, _user_matches_query, _format_user_choice, _truncate - ~287 —Å—Ç—Ä–æ–∫
  - ‚úÖ –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞ (_handle_provider_input, _handle_billing_history_input, _handle_node_create_input, _handle_host_create_input, _handle_billing_nodes_input) - ~770 —Å—Ç—Ä–æ–∫ (—á–∞—Å—Ç–∏—á–Ω–æ —É–¥–∞–ª–µ–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)
- üìã –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ç–æ–º, –∫–∞–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏
- üìã –í `basic.py` –æ—Å—Ç–∞–ª–∏—Å—å –¥—É–±–ª–∏–∫–∞—Ç—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Ä–æ—É—Ç–µ—Ä –≤—Å–µ –µ—â–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `__init__.py`)
- üìã –û—Å—Ç–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ –±–ª–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: user:*, user_edit:*, uef:*, user_configs:*, user_sub_link:*, user_happ_link:*, user_stats:*, node_edit:*, nef:*, node_delete:*, node:*, host:*, token:*, template:*, tplview:*, snippet:*, bulk:users:*, bulk:hosts:*

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
- üìã –ó–∞–º–µ–Ω–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Ñ—É–Ω–∫—Ü–∏–π –≤ `basic.py` –Ω–∞ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π
- üìã –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö:
  - `_navigate`, `_send_subscriptions_page`, `_get_subs_page` ‚Üí `navigation.py`
  - `_start_user_search_flow`, `_handle_user_search_input`, `_run_user_search`, `_show_user_search_results`, `_search_users`, `_fetch_user` ‚Üí `users.py`
  - `_send_user_detail`, `_send_user_summary`, `_store_user_detail_back_target`, `_get_user_detail_back_target` ‚Üí `users.py`
  - `_send_node_detail` ‚Üí `nodes.py`
  - `_send_host_detail` ‚Üí `hosts.py`
  - `_send_template_detail` ‚Üí `resources.py`
  - `_fetch_nodes_text`, `_node_providers_keyboard`, `_node_yes_no_keyboard` ‚Üí `nodes.py`
  - `_fetch_hosts_text`, `_host_config_profiles_keyboard` ‚Üí `hosts.py`
  - `_fetch_configs_text`, `_fetch_snippets_text` ‚Üí `resources.py`
  - `_fetch_billing_text`, `_fetch_billing_nodes_text`, `_fetch_providers_text` ‚Üí `billing.py`
  - `_apply_user_update` ‚Üí `users.py`
  - `_apply_node_update` ‚Üí `nodes.py`
  - `_handle_template_*`, `_handle_provider_input`, `_handle_billing_*`, `_handle_node_*`, `_handle_host_*`, `_handle_user_*` ‚Üí —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
- üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- üìã –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–∑ `basic.py` –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
