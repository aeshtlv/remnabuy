# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

## 1. –î–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –±–æ—Ç—É

### –ü—Ä–æ–±–ª–µ–º–∞
Middleware –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–±—ç–∫–æ–≤.

### –†–µ—à–µ–Ω–∏–µ
- –£–±—Ä–∞–ª `"user:"` –∏–∑ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –≤ `AdminMiddleware`
- –¢–µ–ø–µ—Ä—å –∫–æ–ª–±—ç–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `user:` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ–Ω—é) –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º
- –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–ª–±—ç–∫–∏: `menu:`, `node:`, `host:`, `token:`, `template:`, `snippet:`, `config:`, `billing:`, `provider:`, `bulk:`, `system:`, `nav:`, `subs:`

## 2. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞
–î—É–±–ª–∏–∫–∞—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `/start` –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∞–¥–º–∏–Ω–æ–≤.

### –†–µ—à–µ–Ω–∏–µ
- –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `/start` –∏–∑ `commands.py`
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/start` –≤ `user_public.py` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
  - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  - –ï—Å–ª–∏ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é

## 3. Telegram Stars –ø–ª–∞—Ç–µ–∂–∏ (INVOICE_PAYLOAD_INVALID)

### –ü—Ä–æ–±–ª–µ–º–∞
Payload –¥–ª—è invoice –±—ã–ª —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º (JSON —Å timestamp –∏ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏).
Telegram –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É payload –¥–æ ~128 –±–∞–π—Ç.

### –†–µ—à–µ–Ω–∏–µ
- –ò–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç payload —Å JSON –Ω–∞ –∫–æ—Ä–æ—Ç–∫—É—é —Å—Ç—Ä–æ–∫—É: `user_id:months:stars:promo`
- –ü—Ä–∏–º–µ—Ä: `827449133:3:250:PROMO10`
- –ü–∞—Ä—Å–∏–Ω–≥ –≤ `process_successful_payment` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º

## 4. –ü—Ä–æ–º–æ–∫–æ–¥—ã

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–æ–º–æ–∫–æ–¥—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –ø—Ä–∏ –≤–≤–æ–¥–µ, —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

### –†–µ—à–µ–Ω–∏–µ
- –ü—Ä–æ–º–æ–∫–æ–¥—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ invoice
- –ü—Ä–∏ –≤–≤–æ–¥–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º"
- –ü—Ä–æ–º–æ–∫–æ–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ invoice –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

## 5. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ü—Ä–æ–±–ª–µ–º–∞
–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å.

### –†–µ—à–µ–Ω–∏–µ
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ `/start {referrer_id}`
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `referrals`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∏ –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏ –≤ –º–µ–Ω—é "–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞"

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É
2. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏:
   - üìã –ú–æ—è –ø–æ–¥–ø–∏—Å–∫–∞
   - üí≥ –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
   - üéÅ –ü—Ä–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
   - üé´ –ü—Ä–æ–º–æ–∫–æ–¥
   - üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
   - üåê –Ø–∑—ã–∫

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à Telegram ID –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env`:
   ```env
   ADMINS=–≤–∞—à_telegram_id
   ```
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É
3. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏:
   - üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - üõ∞ –ù–æ–¥—ã/–•–æ—Å—Ç—ã/–ü—Ä–æ—Ñ–∏–ª–∏
   - üß∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
   - üí≥ –ë–∏–ª–ª–∏–Ω–≥
   - üì¶ –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - ‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã:
1. –í—ã–±–µ—Ä–∏—Ç–µ "üí≥ –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ (1, 3, 6, 12 –º–µ—Å—è—Ü–µ–≤)
3. –ù–∞–∂–º–∏—Ç–µ "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å"
4. Telegram –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã Stars (–±–µ–∑ –æ—à–∏–±–∫–∏ INVOICE_PAYLOAD_INVALID)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –≤ –ë–î:
   ```sql
   INSERT INTO promo_codes (code, discount_percent, max_uses) 
   VALUES ('TEST10', 10, 100);
   ```
2. –í—ã–±–µ—Ä–∏—Ç–µ "üé´ –ü—Ä–æ–º–æ–∫–æ–¥"
3. –í–≤–µ–¥–∏—Ç–µ `TEST10`
4. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–∏–¥–∫–µ 10%
5. –ù–∞–∂–º–∏—Ç–µ "üí≥ –ö—É–ø–∏—Ç—å —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º"
6. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É - —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ —Å–∫–∏–¥–∫–æ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:
1. –û—Ç–∫—Ä–æ–π—Ç–µ "üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞"
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –¥—Ä—É–≥–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ Telegram
4. –í –ø–µ—Ä–≤–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

## –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
docker compose down
docker compose up -d
```

–ò–ª–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Python —Å–∫—Ä–∏–ø—Ç.

## –õ–æ–≥–∏

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤:
```bash
docker compose logs -f bot
```

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
- `Invoice created for user` - —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ invoice
- `Payment processed successfully` - —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
- `Unauthorized admin access attempt` - –ø–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ-–∞–¥–º–∏–Ω–∞ –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º

