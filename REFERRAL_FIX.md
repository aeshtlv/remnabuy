# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

## –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º**: –ó–Ω–∞–∫–æ–º—ã–π –∫—É–ø–∏–ª –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –º–µ—Å—è—Ü, –Ω–æ –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä—É –Ω–µ –Ω–∞—á–∏—Å–ª–∏–ª–∏—Å—å.

**–ü—Ä–∏—á–∏–Ω–∞**: –í `src/services/referral_service.py` –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```python
# ‚ùå –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
referrals = Referral.get_referrals_count(referrer_id)
if referrals == 0:
    logger.debug("No referral record found for referrer %s", referrer_id)
    return False
```

–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ `False` (–Ω–µ –Ω–∞—á–∏—Å–ª—è–ª–∞ –±–æ–Ω—É—Å), –µ—Å–ª–∏ —É —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –≤–æ–æ–±—â–µ –Ω–µ –±—ã–ª–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (`count = 0`). –ù–æ —ç—Ç–æ –Ω–µ –∏–º–µ–ª–æ —Å–º—ã—Å–ª–∞ ‚Äî –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–∞—á–∏—Å–ª–µ–Ω –ª–∏ –±–æ–Ω—É—Å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —ç—Ç–æ–º—É —Ä–µ—Ñ–µ—Ä–∞–ª—É**.

---

## –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞: —Ç–µ–ø–µ—Ä—å –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ **–∑–∞–ø–∏—Å—å –æ —Ä–µ—Ñ–µ—Ä–∞–ª–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `referrals`** –∏ **–Ω–∞—á–∏—Å–ª–µ–Ω—ã –ª–∏ –µ–º—É —É–∂–µ –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏**:

```python
# ‚úÖ –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
from src.database import get_db_connection
with get_db_connection() as conn:
    cursor = conn.cursor()
    cursor.execute("""
        SELECT bonus_days FROM referrals 
        WHERE referrer_id = ? AND referred_id = ?
    """, (referrer_id, referred_user_id))
    row = cursor.fetchone()
    
    if not row:
        logger.debug("No referral record for referrer=%s referred=%s", referrer_id, referred_user_id)
        return None
    
    if row[0] > 0:
        logger.debug("Bonus already granted for referrer=%s referred=%s", referrer_id, referred_user_id)
        return None
```

–¢–µ–ø–µ—Ä—å –±–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (—Ç—Ä–∏–∞–ª –∏–ª–∏ –ø–æ–∫—É–ø–∫–∞) —Ä–µ—Ñ–µ—Ä–∞–ª–∞.

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://t.me/your_bot?start=123456789`)
2. –ë–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—à—ë–ª –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é (`referrer_id` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î)
3. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç—Ä–∏–∞–ª** –∏–ª–∏ **–ø–æ–∫—É–ø–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É**, —Ä–µ—Ñ–µ—Ä–µ—Ä—É –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è **+3 –¥–Ω—è** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `REFERRAL_BONUS_DAYS` –≤ `.env`)
4. –ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑** –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
cd /opt/remnabuy
git pull
docker compose restart bot
docker compose logs -f bot
```

–í –ª–æ–≥–∞—Ö —Ç—ã —É–≤–∏–¥–∏—à—å:

```
‚úÖ Referral bonus granted: referrer=123456789 referred=987654321 bonus_days=3 new_expire=2026-04-10T12:34:56Z
```

–ò –ø–æ–ª—É—á–∏—à—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `NOTIFICATIONS_CHAT_ID`):

```
üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª–µ–Ω

üë§ –†–µ—Ñ–µ—Ä–µ—Ä: @your_username
üÜî ID: 123456789
üéÅ –ë–æ–Ω—É—Å: +3 –¥–Ω–µ–π
‚è≥ –ù–æ–≤–∞—è –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è: 2026-04-10T12:34:56Z

üë• –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π: @friend_username
üÜî ID: 987654321
üìÖ –í—Ä–µ–º—è: 2026-01-07 12:34:56
```

---

## –ï—Å–ª–∏ –±–æ–Ω—É—Å —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª –Ω–∞—á–∏—Å–ª–∏—Ç—å—Å—è

–ï—Å–ª–∏ —Ç–≤–æ–π –¥—Ä—É–≥ —É–∂–µ –∫—É–ø–∏–ª –ø–æ–¥–ø–∏—Å–∫—É –¥–æ —ç—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –±–æ–Ω—É—Å **–Ω–µ –Ω–∞—á–∏—Å–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** (—Ç.–∫. –≤ –ë–î —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω–æ `bonus_days > 0` –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞, –∏–ª–∏ –∑–∞–ø–∏—Å—å –≤–æ–æ–±—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞).

### –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ú–æ–∂–µ—à—å –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±–æ—Ç–∞ –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å Remnawave:

1. –û—Ç–∫—Ä–æ–π –ø–∞–Ω–µ–ª—å Remnawave
2. –ù–∞–π–¥–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –ø–æ `telegram_id` –∏–ª–∏ `username`
3. –ü—Ä–æ–¥–ª–∏ `expireAt` –Ω–∞ +3 –¥–Ω—è (–∏–ª–∏ —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ)

–ò–ª–∏ —á–µ—Ä–µ–∑ SQL (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ `bot_data.db`):

```bash
sqlite3 bot_data.db
```

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å –æ —Ä–µ—Ñ–µ—Ä–∞–ª–µ
SELECT * FROM referrals WHERE referrer_id = 123456789 AND referred_id = 987654321;

-- –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞—Ç—å –µ—ë
INSERT INTO referrals (referrer_id, referred_id, bonus_days) VALUES (123456789, 987654321, 3);

-- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å, –Ω–æ bonus_days = 0, –æ–±–Ω–æ–≤–∏—Ç—å
UPDATE referrals SET bonus_days = 3 WHERE referrer_id = 123456789 AND referred_id = 987654321;
```

–ü–æ—Ç–æ–º –ø—Ä–æ–¥–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –≤ Remnawave –Ω–∞ +3 –¥–Ω—è –≤—Ä—É—á–Ω—É—é.

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

